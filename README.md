# FastAPI Wallet Project

Данный проект представляет собой API для управления кошельками с использованием FastAPI, асинхронной базы данных PostgreSQL и SQLAlchemy. Тесты запускаются в отдельном контейнере и пишутся с использованием `httpx.AsyncClient`.

---

## Оглавление

- [Требования](#требования)
- [Установка и запуск](#установка-и-запуск)
- [Запуск базы данных](#запуск-базы-данных)
- [Запуск приложения](#запуск-приложения)
- [Запуск тестов](#запуск-тестов)
- [Переменные окружения](#переменные-окружения)
- [Особенности тестирования](#особенности-тестирования)
- [Важные моменты](#важные-моменты)

---

## Требования

- Docker и Docker Compose (рекомендуется версии, поддерживающие compose v3.8+)
- Python 3.11 (локально, если не в контейнере)
- PostgreSQL (запускается через Docker Compose)
- Интернет-соединение для установки зависимостей

---

## Установка и запуск

### 1. Клонируйте репозиторий

```bash
git clone https://github.com/Alexion24/Fast_API_wallet_project.git
cd Fast_API_wallet_project
```


### 2. Настройте переменные окружения

В проект помещена настройка переменных через `docker-compose.yml`. Основные переменные:

- `DATABASE_URL` — URL подключения к базе данных в формате:

```bash
postgresql+asyncpg://postgres:postgres@db:5432/<db_name>
```

- `APP_BASE_URL` — адрес запускаемого FastAPI-приложения в контейнере для тестов (`http://app:8000`)

---

## Запуск базы данных

В Docker Compose используется стандартный образ PostgreSQL

Запускать базу не нужно отдельно — команда `docker-compose` запустит сервис автоматически.

---

## Запуск приложения

Для запуска приложения FastAPI:
```bash
docker-compose up --build app
```

- Приложение будет доступно на `http://localhost:8000`
- При старте автоматически создаются таблицы в базе `wallet` (через Lifespan event)

---

## Запуск тестов

Запускать тесты нужно через специальный сервис в Docker Compose, который зависит от базы и приложения и ожидает их готовности:

```bash
docker-compose up run --rm tests
```

Или полностью с билдом и запуском всех сервисов:
```bash
docker-compose up --build tests
```

Тесты используют базу `test_wallet`, создают таблицы перед тестами и удаляют их после, обеспечивая изоляцию.

---

## Переменные окружения

В `docker-compose.yml` задаются:

- Для `app`:
```bash
environment:
DATABASE_URL: postgresql+asyncpg://postgres:postgres@db:5432/wallet
```
- Для `tests`:
```bash
environment:
DATABASE_URL: postgresql+asyncpg://postgres:postgres@db:5432/test_wallet
APP_BASE_URL: http://app:8000
```

---

## Особенности тестирования

- Тесты выполняются асинхронно с использованием `pytest-asyncio`.
- Используется `httpx.AsyncClient` с реальным HTTP запросом на контейнер с приложением (test container → app container).
- Для тестовой базы `test_wallet` таблицы создаются/удаляются программно в фикстуре.
- Все тесты расположены в `backend/tests/`.

---

## Важные моменты

- Убедитесь, что все контейнеры работают в одной сети Docker Compose (по умолчанию создаётся общая сеть).
- Перед запуском тестов база `test_wallet` должна существовать в Postgres (скрипт создания заложен в `entrypoint.sh`).

---









